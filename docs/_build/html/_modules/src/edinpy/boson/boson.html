<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.edinpy.boson.boson &mdash; edinpy 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            edinpy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">edinpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">src.edinpy.boson.boson</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src.edinpy.boson.boson</h1><div class="highlight"><pre>
<span></span><span class="n">_dofs</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># global list of constructed degrees of freedom (DoF)</span>
<span class="n">_N_vector</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># global list of attributes &lt;dof&gt;.N for nD -&gt; 1D mapping</span>
<span class="n">_fockspace</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># global var for constructed Fock space</span>

<div class="viewcode-block" id="clear">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.clear">[docs]</a>
<span class="k">def</span> <span class="nf">clear</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Clear all the degrees of freedom and fock space stored as global variables. It is</span>
<span class="sd">        necessary to call this function when you want to change the model.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">global</span> <span class="n">_dofs</span><span class="p">,</span> <span class="n">_N_vector</span><span class="p">,</span> <span class="n">_fockspace</span>
    <span class="n">_dofs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_N_vector</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_fockspace</span> <span class="o">=</span> <span class="kc">None</span></div>


<span class="n">_normal_chars</span> <span class="o">=</span> <span class="s2">&quot;0123456789,&quot;</span>
<span class="n">_subscript_chars</span> <span class="o">=</span> <span class="s2">&quot;₀₁₂₃₄₅₆₇₈₉,&quot;</span>
<span class="c1">#_superscript_chars = &quot;⁰¹²³⁴⁵⁶⁷⁸⁹&quot;</span>
<span class="n">_mapping</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">_normal_chars</span><span class="p">,</span> <span class="n">_subscript_chars</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_subscripts</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Converts subscript from normal text numbers to subscript numbers.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">converted_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">_mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">converted_text</span>

<div class="viewcode-block" id="DoF">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.DoF">[docs]</a>
<span class="k">class</span> <span class="nc">DoF</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create a degree of freedom.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N_eigenvalues : int</span>
<span class="sd">        Number of eigenvalues of the associated observable, e.g. electron</span>
<span class="sd">        spin has 2 eigenvalues, a chain of 5 atoms has 5 position eigenvalues.</span>
<span class="sd">    name : string</span>
<span class="sd">        Name of the observable.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N_eigenvalues</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">=</span> <span class="n">N_eigenvalues</span> <span class="c1"># number of eigvals of observable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="c1"># given name of observable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_dof</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Add DoF to global vars lists.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">global</span> <span class="n">_dofs</span><span class="p">,</span> <span class="n">_N_vector</span>

        <span class="c1"># add attr N to a global list used to calculate effective sites</span>
        <span class="k">if</span> <span class="n">_N_vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_N_vector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_N_vector</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">_dofs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_N_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># add DoF to a global list</span>
        <span class="k">if</span> <span class="n">_dofs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_dofs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_dofs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># numerical label of DoF</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Number of eigenvalues set by parameter `N_eigenvalues`.</span>
<span class="sd">        :type: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>
    
    <span class="nd">@N</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">=</span> <span class="n">N</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Name given to the degree of freedom</span>
<span class="sd">        :type: string</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    
    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Numerical label given to the degree of freedom</span>
<span class="sd">        :type: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>
    
    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span></div>


<div class="viewcode-block" id="model">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.model">[docs]</a>
<span class="k">class</span> <span class="nc">model</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Construct a model with the stored degrees of freedom.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Nb : int</span>
<span class="sd">        Number of bosons.</span>
<span class="sd">    auto : bool</span>
<span class="sd">        If auto is True then the Fock space is calculated automatically, otherwise</span>
<span class="sd">        the user must use the build() method to calculate it manually.           </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nb</span><span class="p">,</span> <span class="n">auto</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">_dofs</span><span class="p">,</span> <span class="n">_N_vector</span><span class="p">,</span> <span class="n">_Nb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dofs</span> <span class="o">=</span> <span class="n">_dofs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nvec</span> <span class="o">=</span> <span class="n">_N_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">=</span> <span class="n">_Nb</span> <span class="o">=</span> <span class="n">Nb</span>

        <span class="k">if</span> <span class="n">auto</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        
<div class="viewcode-block" id="model.build">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.model.build">[docs]</a>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build the Fock space with the given number of fermions and degrees of freedom.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">prod</span>
        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span> <span class="k">as</span> <span class="n">fact</span>
        <span class="k">global</span> <span class="n">_Neff</span><span class="p">,</span> <span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_fockspace</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span> <span class="o">=</span> <span class="n">_Neff</span> <span class="o">=</span> <span class="n">prod</span><span class="p">([</span><span class="n">dof</span><span class="o">.</span><span class="n">N</span> <span class="k">for</span> <span class="n">dof</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dofs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span> <span class="o">=</span> <span class="n">_Nbasis</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">fact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nb</span><span class="p">)</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fockspace</span> <span class="o">=</span> <span class="n">_fockspace</span> <span class="o">=</span> <span class="n">bosonspace</span><span class="p">()</span>
        <span class="n">_fockspace</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fockspace</span><span class="o">.</span><span class="n">build</span><span class="p">()</span></div>


<div class="viewcode-block" id="model.activate">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.model.activate">[docs]</a>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Set this model as the active instance.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">global</span> <span class="n">_dofs</span><span class="p">,</span> <span class="n">_N_vector</span>
        <span class="k">global</span> <span class="n">_Neff</span><span class="p">,</span> <span class="n">_Nb</span><span class="p">,</span> <span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_fockspace</span>

        <span class="n">_dofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dofs</span>
        <span class="n">_N_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nvec</span>
        <span class="n">_Neff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span>
        <span class="n">_Nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span>
        <span class="n">_Nbasis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span>
        <span class="n">_fockspace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fockspace</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Neff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Number of effective sites.</span>
<span class="sd">        :type: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span>
    
    <span class="nd">@Neff</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">Neff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Neff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span> <span class="o">=</span> <span class="n">Neff</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Nbasis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Number of basis states in the Fock space.</span>
<span class="sd">        :type: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span>
    
    <span class="nd">@Nbasis</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">Nbasis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nbasis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span> <span class="o">=</span> <span class="n">Nbasis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fockspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Class instance for the relevant Fock space of the current model.</span>
<span class="sd">        :type: fermionspace</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fockspace</span>
    
    <span class="nd">@fockspace</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fockspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fockspace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fockspace</span> <span class="o">=</span> <span class="n">fockspace</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List of instances of degrees of freedom.</span>
<span class="sd">        :type: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dofs</span>
    
    <span class="nd">@dofs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dofs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dofs</span> <span class="o">=</span> <span class="n">dofs</span></div>


<div class="viewcode-block" id="fockstate">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.fockstate">[docs]</a>
<span class="k">class</span> <span class="nc">fockstate</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create a bosonic Fock state.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    state : np.array</span>
<span class="sd">        Occupation numbers of the effective sites represented as a numpy array.</span>
<span class="sd">    amp : scalar</span>
<span class="sd">        Probability amplitude of the state. Default value is 1.</span>
<span class="sd">    index : int</span>
<span class="sd">        Index of the state. Used when constructing a Fock space. Default is None.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">csingle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">bs</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span><span class="o">-</span><span class="n">bs</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="n">negstates</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">bs</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">([</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">negstates</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">amp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">amp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span>
            <span class="n">newfs</span> <span class="o">=</span> <span class="n">fockstate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span><span class="p">)</span>
            <span class="n">newfs</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">newfs</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span>  <span class="n">obj</span><span class="o">.</span><span class="n">dag</span><span class="o">*</span><span class="bp">self</span>
            <span class="n">product</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">product</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">)):</span>
                <span class="n">product</span> <span class="o">*=</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">s</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
<div class="viewcode-block" id="fockstate.is_occupied">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.fockstate.is_occupied">[docs]</a>
    <span class="k">def</span> <span class="nf">is_occupied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_calc_effsite</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Determine whether the effective site is occupied.</span>
<span class="sd">        :param _calc_effsite: effective site index</span>
<span class="sd">        :type _calc_effsite: int</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">_calc_effsite</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="fockstate.calc_tag">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.fockstate.calc_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Calculate the tag of the fock state.</span>
<span class="sd">        :rtype: np.float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_Neff</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">+=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tag</span></div>

    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Human readable representation of Fock state.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">,&#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">&gt;&#39;</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A numerical tag used to uniquely identify the Fock state.</span>
<span class="sd">        :type: float</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span>
    
    <span class="nd">@tag</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span> <span class="o">=</span> <span class="n">tag</span></div>

    
<div class="viewcode-block" id="vacuum">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.vacuum">[docs]</a>
<span class="k">class</span> <span class="nc">vacuum</span><span class="p">(</span><span class="n">fockstate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Create a vacuum state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        amp : scalar</span>
<span class="sd">            Probability amplitude of the state. Default value is `1`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">csingle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vacuum</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">amp</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">amp</span>
            
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span>  <span class="n">obj</span><span class="o">.</span><span class="n">dag</span> <span class="o">*</span> <span class="bp">self</span>
            <span class="n">product</span><span class="o">.</span><span class="n">bra</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bra</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">product</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">)):</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">product</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">s</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ket</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ket</span><span class="p">,</span><span class="n">vacuum</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Human readable representation of Fock state.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s1">&gt;&#39;</span></div>

    
<div class="viewcode-block" id="null">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.null">[docs]</a>
<span class="k">class</span> <span class="nc">null</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Additive identity for Fock states and operators.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">csingle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bs</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Human readable representation of Fock state.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;0&#39;</span></div>

    
<div class="viewcode-block" id="statesum">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.statesum">[docs]</a>
<span class="k">class</span> <span class="nc">statesum</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Sum of Fock states.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stateslist : list</span>
<span class="sd">        List containing Fock states.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stateslist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">stateslist</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">]</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">)):</span>
                <span class="n">product</span> <span class="o">*=</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">statesum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">bra</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="n">bra</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">bra</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ket</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                    <span class="nb">sum</span> <span class="o">+=</span> <span class="n">bra</span><span class="o">*</span><span class="n">ket</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>

    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">string</span></div>


<div class="viewcode-block" id="bosonspace">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace">[docs]</a>
<span class="k">class</span> <span class="nc">bosonspace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create a bosonic Fock space.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_Neff</span><span class="p">,</span> <span class="n">_Nb</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span> <span class="o">=</span> <span class="n">_Nbasis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span> <span class="o">=</span> <span class="n">_Neff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">=</span> <span class="n">_Nb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect_left</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">i</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="n">contains</span> <span class="o">=</span> <span class="fm">__contains__</span>

<div class="viewcode-block" id="bosonspace.build">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace.build">[docs]</a>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Build the fock space basis vectors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fockstate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstvector</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># calculate the first state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span>
        <span class="c1"># calculate the remaining states in lexicographical order</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nbasis</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fockstate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextvector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span></div>

     
<div class="viewcode-block" id="bosonspace.firstvector">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace.firstvector">[docs]</a>
    <span class="k">def</span> <span class="nf">firstvector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Generate the first bosonic occupation vector in lexicographic ordering corresponding to the ket bv = |Nb,0,0,...,0&gt; with dim(bv) = Neff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>
        <span class="n">bv</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span> <span class="c1"># fill the first effective site with Nb bosons</span>
        <span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span>
        <span class="k">return</span> <span class="n">bv</span></div>

    
<div class="viewcode-block" id="bosonspace.findk">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace.findk">[docs]</a>
    <span class="k">def</span> <span class="nf">findk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Programmatically find the index k which generates the next basis vector in lexicographical order.</span>
<span class="sd">        Algorithm statement: Find k such that n_k =/= 0 and n_i = 0 for k+1&lt;=i&lt;=M-1. If there is no such k </span>
<span class="sd">        then n is the last lexicographic basis vector. </span>
<span class="sd">        </span>
<span class="sd">        Source - J M Zhang and R X Dong 2010 Eur. J. Phys. 31 591</span>

<span class="sd">        :param bv: a bosonic occupation vector</span>
<span class="sd">        :type bv: np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find k such that n_k =/= 0 and n_i = 0 for k+1 &lt;= i &lt;= M-1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># For every site except the last site,</span>
            <span class="n">found_k</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">bv</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># find the first non-zero element (NZE) from left to right.</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># For every element to the right of NZE except the last site,</span>
                    <span class="k">if</span> <span class="n">bv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if there are NZE to the right</span>
                        <span class="n">found_k</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span> <span class="c1"># then break loop and check next index k.</span>
                <span class="c1"># If loop not broken then n_i =0 for i=k+1,...,M-1, then k exists.</span>
                <span class="k">if</span> <span class="n">found_k</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">k</span>
        <span class="c1"># If there is no such k then n is the last lexicographic basis vector.</span>
        <span class="k">return</span></div>

    
<div class="viewcode-block" id="bosonspace.nextvector">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace.nextvector">[docs]</a>
    <span class="k">def</span> <span class="nf">nextvector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bv</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Find the next bosonic occupation vector in lexicographical order.</span>
<span class="sd">        </span>
<span class="sd">        Source - J M Zhang and R X Dong 2010 Eur. J. Phys. 31 591</span>

<span class="sd">        :param bv: a bosonic occupation vector</span>
<span class="sd">        :type bv: np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">copy</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findk</span><span class="p">(</span><span class="n">bv</span><span class="p">)</span> <span class="c1"># k-index that generates next vector</span>

        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">newbs</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">bv</span><span class="p">)</span> <span class="c1"># next basis vector</span>
        
        <span class="c1"># subtract one from site k</span>
        <span class="n">newbs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">bv</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        
        <span class="c1"># fill site k+1 with remaining number of particles</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">bv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">newbs</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span> 
        
        <span class="c1"># empty sites from k+2 to M</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Neff</span><span class="p">):</span>
            <span class="n">newbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># copy site filling for sites left of k</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">newbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">newbs</span></div>

    
<div class="viewcode-block" id="bosonspace.show">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.bosonspace.show">[docs]</a>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Print all the basis states.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;state </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="scalar">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.scalar">[docs]</a>
<span class="k">class</span> <span class="nc">scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create a scalar.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value : scalar</span>
<span class="sd">        The numerical value of the scalar</span>
<span class="sd">    label : str</span>
<span class="sd">        A string label for the scalar</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
            <span class="n">os</span> <span class="o">+=</span> <span class="n">obj</span><span class="o">.</span><span class="n">os</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclr</span><span class="p">])</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="n">negobj</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">negobj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">sclr</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclr</span><span class="p">])</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">negself</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="n">negself</span><span class="p">])</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vacuum</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">amp</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="n">obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">amp</span>
                <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="n">prod</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>  

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span>
            <span class="k">return</span> <span class="n">scalar</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the label of the scalar.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span></div>

    
<div class="viewcode-block" id="operator">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.operator">[docs]</a>
<span class="k">class</span> <span class="nc">operator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create an annihilation operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    indices : iterable or int</span>
<span class="sd">        The indices which the operator acts on. If `indices` is an `int` then it is assumed </span>
<span class="sd">        to refer to the effective site.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_effsite</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;(-1)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">negone</span> <span class="o">*</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclr</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">o</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">sclr</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">obj</span><span class="p">,</span> <span class="n">negone</span> <span class="o">*</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">fockstate</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">null</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">operator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">o</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">operatorproduct</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="p">[</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span> <span class="p">]</span>
            <span class="n">op</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="n">op</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span>   
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>

    <span class="k">def</span> <span class="nf">_annihilate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Annihilate a particle in a Fock state.</span>

<span class="sd">        :param bs: a bosonic Fock state</span>
<span class="sd">        :type bs: fockstate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">copy</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="n">vacuum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">()</span>
        
        <span class="c1"># Annihilate fermion in i-th site</span>
        <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">is_occupied</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">):</span> <span class="c1"># if the site occupation number n_i != 0</span>
            
            <span class="n">newamp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">])</span>
            <span class="n">newstate</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
            <span class="n">newstate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">newstate</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">vacuum</span><span class="p">(</span><span class="n">amp</span> <span class="o">=</span> <span class="n">newamp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">newstate</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">newamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># otherwise annihilate the state</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Action of the annihilation operator on a Fock state.</span>

<span class="sd">        :param bs: a bosonic Fock state</span>
<span class="sd">        :type bs: fockstate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annihilate</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_checkdims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check the dimensions of the indices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_dofs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number of indices </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span><span class="si">}</span><span class="s1"> exceeds the number of degrees of freedom </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_dofs</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_dofs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">d</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
                <span class="n">nameorlabel</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">d</span><span class="o">.</span><span class="n">label</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The index </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> at position </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> is out of bounds for DoF [</span><span class="si">{</span><span class="n">nameorlabel</span><span class="si">}</span><span class="s1">] of size </span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1"> (0 &lt; index &lt; </span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">N</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_calc_effsite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the effective site corresponding the given indices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">&gt;=</span> <span class="n">_Neff</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The index </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="si">}</span><span class="s1"> is out of bounds for the number of effective sites </span><span class="si">{</span><span class="n">_Neff</span><span class="si">}</span><span class="s1"> (0 &lt; index &lt; </span><span class="si">{</span><span class="n">_Neff</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
            <span class="k">return</span>
        
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkdims</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">_N_vector</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">))</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the Hermitian adjoint of the operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">dagger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The indices which the operator acts on.</span>
<span class="sd">        :rtype: iterable or int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span>
    
    <span class="nd">@indices</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="n">indices</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">site</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Effective site that the operator acts on.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site</span>
    
    <span class="nd">@site</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effsite</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="n">effsite</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the string representing the operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
        <span class="k">return</span> <span class="s1">&#39;b&#39;</span> <span class="o">+</span> <span class="n">_subscripts</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="dagger">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.dagger">[docs]</a>
<span class="k">class</span> <span class="nc">dagger</span><span class="p">(</span><span class="n">operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Hermitian adjoint of an operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    indices : iterable or int</span>
<span class="sd">        The indices which the operator acts on. If `indices` is an `int` then it is assumed </span>
<span class="sd">        to refer to the effective site.</span>
<span class="sd">    site : int</span>
<span class="sd">        Effective site that the operator acts on.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">site</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site</span> <span class="o">=</span> <span class="n">site</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">dagger</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">site</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Creation operator acting on the i-th site. Notation: state s -&gt; (s,p) where p is probability amplitude</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">copy</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="n">vacuum</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>
            <span class="k">global</span> <span class="n">_Neff</span>
            <span class="n">newstate</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">_Neff</span><span class="p">)</span>
            <span class="n">newstate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span> <span class="n">newstate</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">amp</span><span class="p">)</span>
        
        <span class="n">newamp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">newstate</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="n">newstate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">newstate</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">newamp</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the Hermitian adjoint of the operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">operator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the string representing the operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
        <span class="k">return</span> <span class="s1">&#39;b†&#39;</span> <span class="o">+</span> <span class="n">_subscripts</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="operatorsum">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.operatorsum">[docs]</a>
<span class="k">class</span> <span class="nc">operatorsum</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Sum of operators.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    operatorlist : list</span>
<span class="sd">        A list containing the operators that are summed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operatorlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_os</span> <span class="o">=</span> <span class="n">operatorlist</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">sclr</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sclr</span> <span class="o">+</span> <span class="bp">self</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">negobj</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span> <span class="o">+</span> <span class="n">negobj</span><span class="o">.</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">sclr</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sclr</span> <span class="o">+</span> <span class="n">negone</span><span class="o">*</span><span class="bp">self</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">sclr</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">sclr</span> <span class="o">*</span> <span class="bp">self</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the Hermitian adjoint of the sum operators.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">listdag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">):</span>
            <span class="n">listdag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">dag</span>
        <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">listdag</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">os</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the list of summed operators</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span>
    
    <span class="nd">@os</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">os</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operatorlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_os</span> <span class="o">=</span> <span class="n">operatorlist</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the string representing the sum of operators.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">string</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_os</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
        <span class="k">return</span> <span class="n">string</span></div>


        
<div class="viewcode-block" id="operatorproduct">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.operatorproduct">[docs]</a>
<span class="k">class</span> <span class="nc">operatorproduct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Product of operators.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    operatorlist : list</span>
<span class="sd">        A list containing the operators that are summed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
            
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operatorlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_op</span> <span class="o">=</span> <span class="n">operatorlist</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;(-1)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">negone</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">os</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclr</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="bp">self</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">scalar</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">negobj</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">obj</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
            <span class="n">os</span> <span class="o">+=</span> <span class="n">negobj</span><span class="o">.</span><span class="n">os</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclr</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">negself</span> <span class="o">=</span> <span class="n">negone</span> <span class="o">*</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">([</span><span class="n">sclr</span><span class="p">,</span> <span class="n">negself</span><span class="p">])</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fockstate</span><span class="p">):</span>
            <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">obj</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">product</span>
            <span class="k">return</span> <span class="n">product</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">obj</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">]</span>
            <span class="n">op</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorproduct</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">operatorsum</span><span class="p">):</span>
            <span class="n">os</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">os</span><span class="p">):</span>
                <span class="n">os</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">o</span>
            <span class="k">return</span> <span class="n">operatorsum</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">statesum</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">)):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">*</span><span class="n">obj</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">sclr</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">sclr</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">listdag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">):</span>
            <span class="n">listdag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">dag</span>
        <span class="n">listdag</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">listdag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">(</span><span class="n">listdag</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the string representing the product of operators.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">)):</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
        <span class="k">return</span> <span class="n">string</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the list of multiplied operators</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span>
    
    <span class="nd">@op</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operatorlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_op</span> <span class="o">=</span> <span class="n">operatorlist</span></div>

    
<div class="viewcode-block" id="number">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.number">[docs]</a>
<span class="k">class</span> <span class="nc">number</span><span class="p">(</span><span class="n">operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Create a number operator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    indices : iterable or int</span>
<span class="sd">        The indices which the operator acts on. If `indices` is an `int` then it is assumed </span>
<span class="sd">        to refer to the effective site.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indices</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_effsite</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">negone</span> <span class="o">=</span> <span class="n">scalar</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;(-1)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">operatorproduct</span><span class="p">([</span><span class="n">negone</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Count the number of particles in a Fock state.</span>

<span class="sd">        :param bs: a bosonic Fock state</span>
<span class="sd">        :type bs: fockstate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span><span class="n">vacuum</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">is_occupied</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">):</span> <span class="c1"># if the site occupation number n_i != 0</span>
            <span class="n">newamp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">amp</span> <span class="o">*</span> <span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_site</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">fockstate</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">newamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>
    
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
        <span class="k">return</span> <span class="s1">&#39;n&#39;</span> <span class="o">+</span> <span class="n">_subscripts</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the Hermitian adjoint of the number operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the string representing the number operator.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
        <span class="k">return</span> <span class="s1">&#39;n&#39;</span> <span class="o">+</span> <span class="n">_subscripts</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="hamiltonian">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.hamiltonian">[docs]</a>
<span class="k">class</span> <span class="nc">hamiltonian</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Create a hamiltonian.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : operator, operatorsum, operatorproduct or hamiltonian</span>
<span class="sd">            Operator form of the hamiltonian</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opform</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">opform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dense_matrix</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">dense_matrix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">sparse_matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_opform</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dense_matrix</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="hamiltonian.calc_matrix">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.hamiltonian.calc_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the matrix form of the Hamiltonian.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">csingle</span>
        <span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_array</span> <span class="k">as</span> <span class="n">csr</span>

        <span class="n">HM_upper</span> <span class="o">=</span> <span class="n">csr</span><span class="p">((</span><span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_Nbasis</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">)</span> <span class="c1"># upper triangular sparse matrix</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">_Nbasis</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span> <span class="c1"># matrix elements of sparse matrix</span>
        <span class="n">diag</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">_Nbasis</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">)</span> <span class="c1"># matrix elements of sparse matrix</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculating matrix elements of Hamiltonian.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_Nbasis</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">_Nbasis</span><span class="o">-</span><span class="n">i</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># row indices of sparse matrix</span>
            <span class="n">column</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">_Nbasis</span><span class="o">-</span><span class="n">i</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># column indices of sparse matrix</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">_Nbasis</span><span class="o">-</span><span class="n">i</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">)</span> <span class="c1"># matrix elements of sparse matrix</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index of non-zero matrix elements in data array</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">_Nbasis</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;row: </span><span class="si">{</span><span class="n">i</span><span class="o">/</span><span class="n">_Nbasis</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%, column: </span><span class="si">{</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">_Nbasis</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">_fockspace</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_opform</span> <span class="o">*</span> <span class="n">_fockspace</span><span class="o">.</span><span class="n">basis</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">element</span> <span class="o">!=</span> <span class="mi">0</span><span class="n">j</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">diag</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="n">element</span>
                        <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">row</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">column</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+=</span> <span class="n">element</span>
                    <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span> 
            <span class="n">HM_upper</span> <span class="o">+=</span> <span class="n">csr</span><span class="p">((</span><span class="n">data</span><span class="p">,(</span><span class="n">row</span><span class="p">,</span><span class="n">column</span><span class="p">)),</span> <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_Nbasis</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">)</span> <span class="c1"># add row to upper triangular matrix</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;row: </span><span class="si">{</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%, column: </span><span class="si">{</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
        <span class="n">HM_diag</span> <span class="o">=</span> <span class="n">csr</span><span class="p">((</span><span class="n">diag</span><span class="p">,</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">)),</span> <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">_Nbasis</span><span class="p">,</span> <span class="n">_Nbasis</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">csingle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span> <span class="o">=</span> <span class="n">HM_upper</span> <span class="o">+</span> <span class="n">HM_upper</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">HM_diag</span></div>


<div class="viewcode-block" id="hamiltonian.eigsolve">
<a class="viewcode-back" href="../../../../src.edinpy.boson.html#src.edinpy.boson.boson.hamiltonian.eigsolve">[docs]</a>
    <span class="k">def</span> <span class="nf">eigsolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sparse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">numeigs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="s1">&#39;SA&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the eigenvalues and eigenvectors of the Hamiltonian.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sparse : bool</span>
<span class="sd">            Determine whether to calculate the eigensystem using sparse or dense linear algebra.</span>
<span class="sd">        numeigs : int</span>
<span class="sd">            Number of eigenvalues and eigenvectors to return. Set to `&#39;all&#39;` to return all eigenvalues. </span>
<span class="sd">        which : str</span>
<span class="sd">            Determine the order in which to calculate the eigenvalues. See `scipy.sparse.linalg.eigsh`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">numeigs</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">numeigs</span> <span class="o">=</span> <span class="n">_Nbasis</span>

        <span class="k">if</span> <span class="n">sparse</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">eigsh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span> <span class="o">=</span> <span class="n">eigsh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparse</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">numeigs</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="n">which</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>        
            <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">eigh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span><span class="p">[:,</span> <span class="p">:</span><span class="n">numeigs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span><span class="p">[:,</span> <span class="p">:</span><span class="n">numeigs</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the dense matrix form of the Hamiltonian. Calculates the matrix if</span>
<span class="sd">        it hasn&#39;t been already.</span>
<span class="sd">        :rtype: np.array</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calc_matrix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dense_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense_matrix</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the sparse matrix form of the Hamiltonian. Calculates the matrix if</span>
<span class="sd">        it hasn&#39;t been already.</span>
<span class="sd">        :rtype: scipy.sparse.csr_matrix</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_matrix</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparse_matrix</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eigvals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the calculated eigvals of the Hamiltonian.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The eigensolutions must be calculated first&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvals</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eigvecs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the calculated eigvecs of the Hamiltonian.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;The eigensolutions must be calculated first&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eigvecs</span></div>

    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alex Santacruz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>